<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Support Bot</title>
    <link rel="stylesheet" href="/css/supportbot.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">ğŸ¤–</span>
                    <span class="logo-text">TaskFlow Support</span>
                </div>
            </div>

            <!-- Customer Selection -->
            <div class="customer-section">
                <h3>ğŸ‘¤ Customer Profile</h3>
                <select id="customerSelect" class="customer-select">
                    <option value="">Anonymous User</option>
                    <option th:each="customer : ${customers}" th:value="${customer.id()}"
                        th:text="${customer.name() + ' (' + customer.plan().getDisplayName() + ')'}">
                    </option>
                </select>
                <div id="customerInfo" class="customer-info hidden">
                    <div class="info-row">
                        <span class="label">Email:</span>
                        <span id="customerEmail" class="value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Plan:</span>
                        <span id="customerPlan" class="value badge">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Company:</span>
                        <span id="customerCompany" class="value">-</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>âš¡ Quick Actions</h3>
                <button class="action-btn" onclick="quickQuestion('How do I reset my password?')">
                    ğŸ” Password Reset
                </button>
                <button class="action-btn" onclick="quickQuestion('What are the pricing plans?')">
                    ğŸ’° Pricing Info
                </button>
                <button class="action-btn" onclick="quickQuestion('The app is not loading')">
                    ğŸ”§ Troubleshoot
                </button>
                <button class="action-btn" onclick="quickQuestion('How do I integrate with Slack?')">
                    ğŸ”— Integrations
                </button>
            </div>

            <!-- Session Info -->
            <div class="session-info">
                <h3>ğŸ“Š Session Stats</h3>
                <div class="stat-row">
                    <span>Messages:</span>
                    <span id="messageCount">0</span>
                </div>
                <div class="stat-row">
                    <span>Sentiment:</span>
                    <span id="currentSentiment">ğŸ˜</span>
                </div>
                <button class="clear-btn" onclick="clearChat()">ğŸ—‘ï¸ Clear Chat</button>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-container">
            <header class="chat-header">
                <h1>ğŸ’¬ TaskFlow Support Chat</h1>
                <p>Ask me anything about TaskFlow! I can help with features, billing, troubleshooting, and more.</p>
            </header>

            <div id="chatMessages" class="chat-messages">
                <!-- Welcome Message -->
                <div class="message bot-message">
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-content">
                        <p>ğŸ‘‹ <strong>Welcome to TaskFlow Support!</strong></p>
                        <p>I'm your AI assistant, here to help you with:</p>
                        <ul>
                            <li>ğŸ“š Product features and usage</li>
                            <li>ğŸ’³ Billing and subscription questions</li>
                            <li>ğŸ”§ Troubleshooting and technical issues</li>
                            <li>ğŸ”— Integrations and API help</li>
                        </ul>
                        <p>How can I assist you today?</p>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typingIndicator" class="typing-indicator hidden">
                <div class="message-avatar">ğŸ¤–</div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <!-- Input Area -->
            <div class="chat-input-container">
                <textarea id="messageInput" class="chat-input"
                    placeholder="Type your message here... (Press Enter to send, Shift+Enter for new line)"
                    rows="1"></textarea>
                <button id="sendBtn" class="send-btn" onclick="sendMessage()">
                    <span>Send</span>
                    <span class="send-icon">â¤</span>
                </button>
            </div>
        </main>

        <!-- Right Panel - Tickets -->
        <aside class="tickets-panel">
            <div class="panel-header">
                <h2>ğŸ« Your Tickets</h2>
                <button class="refresh-btn" onclick="loadTickets()">ğŸ”„</button>
            </div>

            <div id="ticketsList" class="tickets-list">
                <div class="empty-state">
                    <p>No tickets yet.</p>
                    <p class="subtext">If you need to escalate an issue, just ask to "speak to a human" and I'll create
                        a ticket for you.</p>
                </div>
            </div>
        </aside>
    </div>

    <script src="/js/supportbot.js"></script>
</body>

</html>